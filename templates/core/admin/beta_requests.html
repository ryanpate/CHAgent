{% extends 'core/admin/base.html' %}

{% block title %}Beta Requests{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white">
                Beta Requests
                {% if pending_count %}
                <span class="ml-2 px-3 py-1 text-sm bg-yellow-600 text-white rounded-full">{{ pending_count }} pending</span>
                {% endif %}
            </h1>
            <p class="text-gray-400 mt-1">Manage beta access requests from churches</p>
        </div>
        <a href="{% url 'admin_dashboard' %}" class="text-gray-400 hover:text-white text-sm">
            &larr; Back to Dashboard
        </a>
    </div>

    <!-- Filter Links -->
    <div class="flex space-x-2">
        <a href="{% url 'admin_beta_requests' %}"
           class="{% if not status_filter %}bg-ch-gold text-black{% else %}bg-ch-gray text-gray-300 hover:bg-ch-dark{% endif %} px-4 py-2 rounded-md text-sm font-medium">
            All
        </a>
        <a href="{% url 'admin_beta_requests' %}?status=pending"
           class="{% if status_filter == 'pending' %}bg-ch-gold text-black{% else %}bg-ch-gray text-gray-300 hover:bg-ch-dark{% endif %} px-4 py-2 rounded-md text-sm font-medium">
            Pending
        </a>
        <a href="{% url 'admin_beta_requests' %}?status=approved"
           class="{% if status_filter == 'approved' %}bg-ch-gold text-black{% else %}bg-ch-gray text-gray-300 hover:bg-ch-dark{% endif %} px-4 py-2 rounded-md text-sm font-medium">
            Approved
        </a>
        <a href="{% url 'admin_beta_requests' %}?status=rejected"
           class="{% if status_filter == 'rejected' %}bg-ch-gold text-black{% else %}bg-ch-gray text-gray-300 hover:bg-ch-dark{% endif %} px-4 py-2 rounded-md text-sm font-medium">
            Rejected
        </a>
        <a href="{% url 'admin_beta_requests' %}?status=invited"
           class="{% if status_filter == 'invited' %}bg-ch-gold text-black{% else %}bg-ch-gray text-gray-300 hover:bg-ch-dark{% endif %} px-4 py-2 rounded-md text-sm font-medium">
            Invited
        </a>
    </div>

    <!-- Requests Table -->
    <div class="bg-ch-dark rounded-lg border border-ch-gray">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-ch-gray">
                <thead>
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Name</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Email</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Church</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Size</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-ch-gray">
                    {% for req in beta_requests %}
                    <tr class="hover:bg-ch-gray transition">
                        <td class="px-4 py-3 text-sm text-white">{{ req.name }}</td>
                        <td class="px-4 py-3 text-sm text-gray-300">{{ req.email }}</td>
                        <td class="px-4 py-3 text-sm text-white">{{ req.church_name }}</td>
                        <td class="px-4 py-3 text-sm text-gray-300">{{ req.get_church_size_display }}</td>
                        <td class="px-4 py-3 text-sm">
                            {% if req.status == 'pending' %}
                            <span class="px-2 py-1 text-xs bg-yellow-900 text-yellow-300 rounded">Pending</span>
                            {% elif req.status == 'approved' %}
                            <span class="px-2 py-1 text-xs bg-green-900 text-green-300 rounded">Approved</span>
                            {% elif req.status == 'rejected' %}
                            <span class="px-2 py-1 text-xs bg-red-900 text-red-300 rounded">Rejected</span>
                            {% elif req.status == 'invited' %}
                            <span class="px-2 py-1 text-xs bg-blue-900 text-blue-300 rounded">Invited</span>
                            {% elif req.status == 'signed_up' %}
                            <span class="px-2 py-1 text-xs bg-purple-900 text-purple-300 rounded">Signed Up</span>
                            {% else %}
                            <span class="px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded">{{ req.status|title }}</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-400">{{ req.created_at|date:"M d, Y" }}</td>
                        <td class="px-4 py-3 text-sm">
                            {% if req.status == 'pending' %}
                            <div class="flex space-x-2">
                                <form method="post" action="{% url 'admin_beta_approve' req.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="px-3 py-1 text-xs bg-green-700 hover:bg-green-600 text-white rounded">
                                        Approve
                                    </button>
                                </form>
                                <form method="post" action="{% url 'admin_beta_reject' req.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="px-3 py-1 text-xs bg-red-700 hover:bg-red-600 text-white rounded">
                                        Reject
                                    </button>
                                </form>
                            </div>
                            {% elif req.reviewed_by %}
                            <span class="text-xs text-gray-500">by {{ req.reviewed_by }}</span>
                            {% else %}
                            <span class="text-xs text-gray-500">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                            No beta requests found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
