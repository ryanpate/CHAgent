{% extends 'base.html' %}

{% block title %}Interactions{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h2 class="font-display text-2xl">Interactions</h2>
        <a href="{% url 'interaction_create' %}" class="px-4 py-2 bg-ch-gold text-black rounded-lg font-medium hover:bg-yellow-500 transition">
            + New Interaction
        </a>
    </div>

    <!-- Search -->
    <form method="get" class="mb-6">
        <div class="flex gap-4">
            <input type="text"
                   name="q"
                   value="{{ search_query }}"
                   placeholder="Search interactions..."
                   class="flex-1 bg-ch-dark border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-ch-gold transition">
            <button type="submit" class="px-6 py-3 bg-ch-gray rounded-lg hover:bg-ch-gold hover:text-black transition">
                Search
            </button>
        </div>
    </form>

    <!-- Interaction List -->
    {% if interactions %}
    <div class="space-y-4">
        {% for interaction in interactions %}
        <a href="{% url 'interaction_detail' interaction.pk %}" class="block bg-ch-dark rounded-lg p-6 hover:bg-ch-gray transition">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <span class="text-gray-400">{{ interaction.user.display_name|default:interaction.user.username }}</span>
                    {% if interaction.volunteers.exists %}
                    <span class="text-gray-600 mx-2">with</span>
                    {% for volunteer in interaction.volunteers.all|slice:":3" %}
                    <span class="text-ch-gold">{{ volunteer.name }}{% if not forloop.last %}, {% endif %}</span>
                    {% endfor %}
                    {% if interaction.volunteers.count > 3 %}
                    <span class="text-gray-500">+{{ interaction.volunteers.count|add:"-3" }} more</span>
                    {% endif %}
                    {% endif %}
                </div>
                <span class="text-sm text-gray-500">{{ interaction.created_at|date:"M j, Y" }}</span>
            </div>
            <p class="text-gray-300 mb-3">{{ interaction.content|truncatewords:40 }}</p>
            {% if interaction.ai_summary %}
            <p class="text-sm text-gray-500 italic">{{ interaction.ai_summary }}</p>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-ch-dark rounded-lg p-12 text-center">
        <p class="text-gray-400 mb-4">
            {% if search_query %}
            No interactions found matching "{{ search_query }}".
            {% else %}
            No interactions logged yet.
            {% endif %}
        </p>
        <a href="{% url 'chat' %}" class="inline-block px-6 py-3 bg-ch-gold text-black rounded-lg font-medium hover:bg-yellow-500 transition">
            Start Logging with AI
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
