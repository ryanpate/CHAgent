{% extends 'base.html' %}

{% block title %}Aria WA Assistant{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Aria Chat - Primary Feature -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Ask Aria</h2>
            <div class="flex gap-2">
                <button onclick="openHistoryModal()"
                        class="px-4 py-2 bg-ch-gray hover:bg-gray-600 rounded-lg transition text-sm flex items-center gap-2"
                        title="View conversation history">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    History
                </button>
                <button onclick="copyConversation()"
                        id="copy-btn"
                        class="px-4 py-2 bg-ch-gray hover:bg-gray-600 rounded-lg transition text-sm flex items-center gap-2"
                        title="Copy conversation to clipboard">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <span id="copy-btn-text">Copy</span>
                </button>
                <button hx-post="{% url 'chat_new_session' %}"
                        hx-target="#chat-messages"
                        hx-swap="innerHTML"
                        class="px-4 py-2 bg-ch-gray hover:bg-ch-gold hover:text-black rounded-lg transition text-sm flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    New Conversation
                </button>
            </div>
        </div>

        <!-- Chat Messages -->
        <div id="chat-messages" class="bg-ch-dark rounded-lg p-6 h-[400px] overflow-y-auto mb-4 space-y-4">
            <!-- Aria Thinking Indicator (hidden by default) -->
            <div id="aria-thinking" class="mr-12 hidden">
                <div class="bg-ch-gray rounded-lg p-4">
                    <div class="flex items-center gap-3">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-ch-gold rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                            <div class="w-2 h-2 bg-ch-gold rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                            <div class="w-2 h-2 bg-ch-gold rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                        </div>
                        <span class="text-sm text-gray-400">Aria is thinking...</span>
                    </div>
                </div>
            </div>
            {% for message in chat_messages %}
            <div class="{% if message.role == 'user' %}ml-12{% else %}mr-12{% endif %}">
                <div class="{% if message.role == 'user' %}bg-ch-gold text-black{% else %}bg-ch-gray markdown-content{% endif %} rounded-lg p-4">
                    {% if message.role == 'user' %}{{ message.content|linebreaks }}{% else %}{{ message.content }}{% endif %}
                </div>
                <p class="text-xs text-gray-500 mt-1 {% if message.role == 'user' %}text-right{% endif %}">
                    {{ message.created_at|timesince }} ago
                </p>
            </div>
            {% empty %}
            <div class="text-center text-gray-400 py-8" id="chat-welcome">
                <p class="mb-4 text-lg">Hi, I'm Aria! Here's what I can help you with:</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 max-w-2xl mx-auto text-sm">
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Log volunteer interactions
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Look up contact info (email, phone)
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Check service schedules
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                        </svg>
                        View blockouts & availability
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                        </svg>
                        Look up song history & setlists
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Get chord charts & lyrics
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        Track prayer requests
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-ch-gold flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Get team insights & summaries
                    </div>
                </div>
                <p class="mt-5 text-gray-500 text-sm">Try: "Who's serving this Sunday?" • "What's Sarah's email?" • "When was 'Goodness of God' last played?"</p>
            </div>
            {% endfor %}
        </div>

        <!-- Input Form -->
        <form hx-post="{% url 'chat_send' %}"
              hx-target="#chat-messages"
              hx-swap="beforeend"
              hx-indicator="#aria-thinking"
              hx-on::before-request="showThinking()"
              hx-on::after-request="hideThinking(); this.reset(); document.getElementById('chat-welcome')?.remove(); document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;"
              class="flex gap-4">
            {% csrf_token %}
            <div class="flex-1 relative">
                <input type="text"
                       name="message"
                       id="chat-input"
                       placeholder="Log an interaction or ask a question..."
                       class="w-full bg-ch-dark border border-gray-700 rounded-lg px-4 py-3 pr-20 focus:outline-none focus:border-ch-gold transition"
                       autocomplete="off"
                       required>
                <!-- Keyboard shortcut hint -->
                <div class="absolute right-3 top-1/2 -translate-y-1/2 hidden sm:flex items-center gap-1 text-gray-500 pointer-events-none">
                    <kbd class="px-1.5 py-0.5 bg-ch-gray rounded text-xs font-mono shortcut-hint-meta">Ctrl</kbd>
                    <span class="text-xs">+</span>
                    <kbd class="px-1.5 py-0.5 bg-ch-gray rounded text-xs font-mono">K</kbd>
                </div>
            </div>
            <button type="submit"
                    class="bg-ch-gold text-black px-6 py-3 rounded-lg font-medium hover:bg-yellow-500 transition flex items-center gap-2">
                <span>Send</span>
                <span class="htmx-indicator">
                    <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
            </button>
        </form>

        <!-- Quick Actions -->
        <div class="mt-4 flex gap-2 flex-wrap">
            <button class="quick-action" onclick="startNewAndSetMessage('Log interaction: ')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Log Interaction
            </button>
            <button class="quick-action" onclick="startNewAndSetMessage('Who is serving this Sunday?')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                This Sunday's Team
            </button>
            <button class="quick-action" onclick="startNewAndSetMessage('What songs did we play last Sunday?')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                </svg>
                Last Setlist
            </button>
            <button class="quick-action" onclick="startNewAndSetMessage('Who is blocked out this Sunday?')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                </svg>
                Check Blockouts
            </button>
            <button class="quick-action" onclick="startNewAndSetMessage('What do we know about ')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                Find Volunteer
            </button>
            <button class="quick-action" onclick="startNewAndSetMessage('Show recent prayer requests')">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                Prayer Requests
            </button>
        </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-ch-dark rounded-xl max-w-lg w-full max-h-[80vh] flex flex-col shadow-2xl">
            <!-- Modal Header -->
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-bold">Conversation History</h3>
                <button onclick="closeHistoryModal()" class="text-gray-400 hover:text-white transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- Search Bar -->
            <div class="p-4 border-b border-gray-700">
                <div class="relative">
                    <input type="text"
                           id="history-search"
                           placeholder="Search conversations..."
                           hx-get="{% url 'chat_history_search' %}"
                           hx-trigger="keyup changed delay:300ms"
                           hx-target="#history-list"
                           hx-include="this"
                           name="q"
                           class="w-full bg-ch-gray border border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:border-ch-gold transition text-sm">
                    <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            <!-- Conversation List -->
            <div id="history-list" class="flex-1 overflow-y-auto p-4">
                <!-- Skeleton loader while loading -->
                <div id="history-skeleton" class="space-y-2">
                    {% include 'core/partials/skeleton_loaders.html' with type='conversation-preview' count=4 %}
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-ch-dark rounded-lg p-6">
            <p class="text-gray-400 text-sm mb-1">Total Volunteers</p>
            <p class="text-3xl font-bold text-ch-gold">{{ total_volunteers }}</p>
        </div>
        <div class="bg-ch-dark rounded-lg p-6">
            <p class="text-gray-400 text-sm mb-1">Total Interactions</p>
            <p class="text-3xl font-bold text-ch-gold">{{ total_interactions }}</p>
        </div>
        <div class="bg-ch-dark rounded-lg p-6">
            <p class="text-gray-400 text-sm mb-1">Log Interaction</p>
            <a href="{% url 'interaction_create' %}" class="inline-flex items-center gap-2 mt-2 px-4 py-2 bg-ch-gray text-white rounded-lg text-sm font-medium hover:bg-ch-gold hover:text-black transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                New Entry
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Interactions -->
        <div class="bg-ch-dark rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Recent Interactions</h3>
                <a href="{% url 'interaction_list' %}" class="text-ch-gold text-sm hover:underline">View all</a>
            </div>
            {% if recent_interactions %}
            <div class="space-y-4">
                {% for interaction in recent_interactions %}
                <a href="{% url 'interaction_detail' interaction.pk %}" class="block bg-ch-gray rounded-lg p-4 hover:bg-gray-700 transition">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm text-gray-400">{{ interaction.user.display_name|default:interaction.user.username }}</span>
                        <span class="text-xs text-gray-500">{{ interaction.created_at|timesince }} ago</span>
                    </div>
                    <p class="text-sm text-gray-300 line-clamp-2">{{ interaction.content|truncatewords:20 }}</p>
                    {% if interaction.volunteers.exists %}
                    <div class="mt-2 flex flex-wrap gap-1">
                        {% for volunteer in interaction.volunteers.all|slice:":3" %}
                        <span class="text-xs bg-ch-gold-muted/30 text-ch-gold px-2 py-0.5 rounded">{{ volunteer.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">No interactions logged yet. Use the AI assistant above to get started!</p>
            {% endif %}
        </div>

        <!-- Top Volunteers -->
        <div class="bg-ch-dark rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Most Mentioned Volunteers</h3>
                <a href="{% url 'volunteer_list' %}" class="text-ch-gold text-sm hover:underline">View all</a>
            </div>
            {% if top_volunteers %}
            <div class="space-y-3">
                {% for volunteer in top_volunteers %}
                <a href="{% url 'volunteer_detail' volunteer.pk %}" class="flex items-center justify-between bg-ch-gray rounded-lg p-4 hover:bg-gray-700 transition">
                    <div>
                        <p class="font-medium">{{ volunteer.name }}</p>
                        {% if volunteer.team %}
                        <p class="text-sm text-gray-400">{{ volunteer.team }}</p>
                        {% endif %}
                    </div>
                    <span class="text-ch-gold font-bold">{{ volunteer.interaction_count }}</span>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">No volunteers in the system yet.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Thinking Indicator Functions
function showThinking() {
    const indicator = document.getElementById('aria-thinking');
    const chatMessages = document.getElementById('chat-messages');
    indicator.classList.remove('hidden');
    // Scroll to show the thinking indicator
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function hideThinking() {
    const indicator = document.getElementById('aria-thinking');
    indicator.classList.add('hidden');
}

// History Modal Functions
function openHistoryModal() {
    const modal = document.getElementById('history-modal');
    const historyList = document.getElementById('history-list');
    const searchInput = document.getElementById('history-search');

    // Show modal
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    // Clear search input
    searchInput.value = '';

    // Load history via HTMX
    htmx.ajax('GET', '{% url "chat_history" %}', {target: '#history-list', swap: 'innerHTML'});
}

function closeHistoryModal() {
    const modal = document.getElementById('history-modal');
    modal.classList.add('hidden');
    document.body.style.overflow = '';
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeHistoryModal();
    }
});

// Close modal when clicking backdrop
document.getElementById('history-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeHistoryModal();
    }
});

function setMessage(text) {
    const input = document.querySelector('input[name="message"]');
    input.value = text;
    input.focus();
}

function startNewAndSetMessage(text) {
    // Clear the chat window by triggering a new session
    fetch('{% url "chat_new_session" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'HX-Request': 'true'
        }
    }).then(response => response.text())
    .then(html => {
        document.getElementById('chat-messages').innerHTML = html;
        // Set the message text and focus
        const input = document.querySelector('input[name="message"]');
        input.value = text;
        input.focus();
    });
}

function copyConversation() {
    const chatContainer = document.getElementById('chat-messages');
    const messages = chatContainer.querySelectorAll(':scope > div:not(#chat-welcome)');

    if (messages.length === 0) {
        showCopyFeedback('No messages to copy', false);
        return;
    }

    let conversationText = '';

    messages.forEach((msgDiv) => {
        // Determine if user or assistant
        const isUser = msgDiv.classList.contains('ml-12');
        const role = isUser ? 'User' : 'Aria';

        // Get the message content
        const contentDiv = msgDiv.querySelector('.rounded-lg.p-4');
        if (contentDiv) {
            // Get text content, preserving some structure
            let content = contentDiv.innerText || contentDiv.textContent;
            content = content.trim();

            // Get timestamp if available
            const timeEl = msgDiv.querySelector('.text-xs.text-gray-500');
            const timestamp = timeEl ? timeEl.textContent.trim() : '';

            conversationText += `${role}:\n${content}\n`;
            if (timestamp) {
                conversationText += `(${timestamp})\n`;
            }
            conversationText += '\n';
        }
    });

    // Add header with current date
    const header = `=== Aria WA Conversation ===\nCopied: ${new Date().toLocaleString()}\n\n`;
    conversationText = header + conversationText;

    // Copy to clipboard
    navigator.clipboard.writeText(conversationText).then(() => {
        showCopyFeedback('Copied!', true);
    }).catch(err => {
        console.error('Failed to copy: ', err);
        // Fallback for older browsers
        fallbackCopy(conversationText);
    });
}

function showCopyFeedback(message, success) {
    const btnText = document.getElementById('copy-btn-text');
    const btn = document.getElementById('copy-btn');
    const originalText = btnText.textContent;

    btnText.textContent = message;
    if (success) {
        btn.classList.add('bg-green-600');
        btn.classList.remove('bg-ch-gray');
    } else {
        btn.classList.add('bg-red-600');
        btn.classList.remove('bg-ch-gray');
    }

    setTimeout(() => {
        btnText.textContent = originalText;
        btn.classList.remove('bg-green-600', 'bg-red-600');
        btn.classList.add('bg-ch-gray');
    }, 2000);
}

function fallbackCopy(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
        document.execCommand('copy');
        showCopyFeedback('Copied!', true);
    } catch (err) {
        showCopyFeedback('Failed to copy', false);
    }

    document.body.removeChild(textArea);
}
</script>

<!-- Keyboard Shortcuts -->
{% include 'core/partials/keyboard_shortcuts.html' %}

<!-- Onboarding Tour for First-Time Users -->
{% include 'core/partials/onboarding_tour.html' %}
{% endblock %}
